apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: portainer-admin-cluster-role
  labels:
    app: portainer
rules:
  # 1ï¸âƒ£ æ ¸å¿ƒèµ„æºï¼šå‘½åç©ºé—´ã€èŠ‚ç‚¹ã€Podã€æœåŠ¡ç­‰
  - apiGroups: [""]
    resources:
      - namespaces
      - namespaces/status         # ä¿®å¤æ‚¨é‡åˆ°çš„ 403 é”™è¯¯
      - nodes
      - nodes/status
      - persistentvolumes
      - persistentvolumeclaims
      - pods
      - pods/status
      - pods/exec
      - pods/log
      - services
      - services/status
      - endpoints
      - configmaps
      - secrets
      - serviceaccounts
      - events
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
      - delete

  # 2ï¸âƒ£ å·¥ä½œè´Ÿè½½ï¼ˆDeployments, StatefulSets, DaemonSets, Jobsï¼‰
  - apiGroups: ["apps"]
    resources:
      - deployments
      - deployments/status
      - deployments/scale
      - statefulsets
      - statefulsets/status
      - statefulsets/scale
      - daemonsets
      - daemonsets/status
      - replicasets
      - replicasets/status
      - replicasets/scale
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
      - delete

  # 3ï¸âƒ£ æ‰¹å¤„ç†ä»»åŠ¡
  - apiGroups: ["batch"]
    resources:
      - jobs
      - jobs/status
      - cronjobs
      - cronjobs/status
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
      - delete

  # 4ï¸âƒ£ ç½‘ç»œèµ„æº
  - apiGroups: ["networking.k8s.io"]
    resources:
      - ingresses
      - ingresses/status
      - networkpolicies
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
      - delete

  # 5ï¸âƒ£ å­˜å‚¨ç±»
  - apiGroups: ["storage.k8s.io"]
    resources:
      - storageclasses
    verbs:
      - get
      - list
      - watch

  # 6ï¸âƒ£ RBAC æŸ¥çœ‹ï¼ˆä¸å»ºè®® Portainer ä¿®æ”¹ RBACï¼Œé™¤éå¿…è¦ï¼‰
  - apiGroups: ["rbac.authorization.k8s.io"]
    resources:
      - clusterroles
      - clusterrolebindings
      - roles
      - rolebindings
    verbs:
      - get
      - list
      - watch

  # 7ï¸âƒ£ è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆCRDï¼‰
  - apiGroups: ["apiextensions.k8s.io"]
    resources:
      - customresourcedefinitions
    verbs:
      - get
      - list
      - watch

  # 8ï¸âƒ£ æŒ‡æ ‡ï¼ˆç”¨äºç›‘æ§å›¾è¡¨ï¼‰
  - apiGroups: ["metrics.k8s.io"]
    resources:
      - pods
      - nodes
    verbs:
      - get
      - list

  # 9ï¸âƒ£ æ‰©å±• APIï¼ˆå¯é€‰ï¼šå¦‚æœæ‚¨ä½¿ç”¨ HorizontalPodAutoscalerï¼‰
  - apiGroups: ["autoscaling"]
    resources:
      - horizontalpodautoscalers
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
      - delete

  # ğŸ”Ÿ æœåŠ¡ç½‘æ ¼/Operator å¸¸è§ CRDï¼ˆå¯é€‰ï¼ŒæŒ‰éœ€æ·»åŠ ï¼‰
  # ä¾‹å¦‚ Istio, Cert-Manager, Prometheus Operator ç­‰
  # - apiGroups: ["cert-manager.io"]
  #   resources: ["certificates", "issuers", "clusterissuers"]
  #   verbs: [get, list, watch, create, update, patch, delete]